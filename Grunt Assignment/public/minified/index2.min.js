import express from"express";import{createServer}from"http";import{Server}from"socket.io";import{fileURLToPath}from"url";import{dirname}from"path";let __filename=fileURLToPath(import.meta.url),__dirname=dirname(__filename),app=express(),server=createServer(app),io=new Server(server),users=(app.use(express.urlencoded({extended:!0})),app.use(express.json()),app.use(express.static(__dirname+"/public")),{});io.on("connection",s=>{console.log("A user connected",s.id),s.on("setRoomUsername",({name:e,room:o})=>{users[s.id]={name:e,room:o},s.join(o),console.log(users[s.id].name+" connected"),s.broadcast.to(o).emit("joinMessage",users[s.id].name+" joined"),s.emit("joinMessage","You joined")}),s.on("newMessage",e=>{e={name:users[s.id].name,message:e};console.log(e),io.to(users[s.id].room).emit("newMessageToAll",e)}),s.on("disconnect",()=>{console.log(`${users[s.id]&&users[s.id].name} disconnected`)})}),app.get("/",(e,o)=>{o.send("Hello, World!")}),server.listen(3e3,()=>{console.log("Server is running at http://localhost:3000")});